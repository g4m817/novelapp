{% extends "profile/base.html" %}
{% block profile_content %}
<div class="row">
  <div class="col s12 m6">
    <h5>Mature Content Settings</h5>
    <form id="matureForm" method="POST" action="{{ url_for('profile.update_profile') }}">
      <!-- Add a hidden field to identify this form submission -->
      <input type="hidden" name="update_mature" value="1">
      <p>
        <label>
          <input type="checkbox" id="showMature" name="show_mature" value="1" {% if user.show_mature %}checked{% endif %}>
          <span>Show Mature Content</span>
        </label>
      </p>
      <button class="btn waves-effect waves-light" type="submit" name="update_mature_button">
        Update Mature Settings
      </button>
    </form>
  </div>
</div>

<!-- Modal Structure -->
<div id="ageModal" class="modal dark">
  <div class="modal-content">
    <h4>Age Confirmation</h4>
    <p>Are you 18 years old or above the legal age in your country?</p>
  </div>
  <div class="modal-footer">
    <a href="#!" id="confirmAge" class="modal-close waves-effect waves-green btn-flat">Yes</a>
    <a href="#!" id="cancelAge" class="modal-close waves-effect waves-red btn-flat">No</a>
  </div>
</div>

<div class="row">
  <!-- Update Email Form -->
  <div class="col s12 m6">
    <h5>Update Email</h5>
    <div class="input-field">
      <input id="email" disabled="disabled" type="email" name="email" value="{{ user.email or '' }}" />
      <label for="email" class="active">Email</label>
    </div>
  </div>
</div>
<div class="row">
  <div class="col s12 m6">
    <h5>Change Password</h5>
    <form method="POST" action="{{ url_for('profile.update_profile') }}">
      <div class="input-field">
        <input id="current_password" type="password" name="current_password" required />
        <label for="current_password">Current Password</label>
      </div>
      <div class="input-field">
        <input id="new_password" type="password" name="new_password" required />
        <label for="new_password">New Password</label>
      </div>
      <div class="input-field">
        <input id="confirm_password" type="password" name="confirm_password" required />
        <label for="confirm_password">Confirm New Password</label>
      </div>
      <button class="btn waves-effect waves-light" type="submit" name="update_password">
        Change Password
      </button>
    </form>
  </div>
</div>
<style>
  .modal, .modal-footer{
    background:#000 !important;
  }
</style>
<script>
// Initialize Materialize Modal
document.addEventListener('DOMContentLoaded', function() {
  var modalElems = document.querySelectorAll('.modal');
  var modalInstances = M.Modal.init(modalElems);
  
  const matureForm = document.getElementById('matureForm');
  matureForm.addEventListener('submit', function(e) {
    // Only intercept if enabling mature content and confirmation hasn't been provided yet
    if(document.getElementById('showMature').checked && !matureForm.dataset.confirmed) {
      e.preventDefault(); // Prevent immediate submission
      var ageModal = M.Modal.getInstance(document.getElementById('ageModal'));
      ageModal.open();
      
      // Confirm Age button listener
      document.getElementById('confirmAge').addEventListener('click', function() {
         matureForm.dataset.confirmed = true;
         matureForm.submit();
      });
      
      // Cancel Age button listener
      document.getElementById('cancelAge').addEventListener('click', function() {
         // Uncheck the checkbox if user is not confirming
         document.getElementById('showMature').checked = false;
      });
    }
  });
});
</script>
{% endblock %}

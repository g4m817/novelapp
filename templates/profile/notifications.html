{% extends "profile/base.html" %}
{% block profile_content %}
<h4>Notifications</h4>

<form action="{{ url_for('profile.mark_all_notifications_read') }}" method="POST" style="display:inline;">
  <button type="submit">Mark All as Read</button>
</form>
<form action="{{ url_for('profile.clear_notifications') }}" method="POST" style="display:inline; margin-left:10px;">
  <button type="submit" onclick="return confirm('Are you sure you want to clear all notifications?');">Clear
    All</button>
</form>

{% if notifications %}
<ul>
  {% for notif in notifications %}
  <li style="margin-bottom: 10px;{% if not notif.is_read %}font-weight: bold;{% endif %}">
    {{ notif.message }}
    <small>({{ notif.created_at.strftime("%Y-%m-%d %H:%M") }})</small>
    {% if "commented" in notif.message|lower %}
    <!-- Example: If notification message indicates a comment, add a link to the story -->
    <a href="{{ url_for('story_views.read_story', story_id=notif.story_id) }}">View Story</a>
    {% endif %}
  </li>
  {% endfor %}
</ul>

<!-- Pagination Controls -->
<div class="pagination">
  {% if pagination.has_prev %}
  <a href="{{ url_for('profile_views.notifications', page=pagination.prev_num) }}">« Prev</a>
  {% else %}
  <span>« Prev</span>
  {% endif %}

  {% for page_num in pagination.iter_pages(left_edge=2, right_edge=2, left_current=2, right_current=2) %}
  {% if page_num %}
  {% if page_num == pagination.page %}
  <strong>{{ page_num }}</strong>
  {% else %}
  <a href="{{ url_for('profile_views.notifications', page=page_num) }}">{{ page_num }}</a>
  {% endif %}
  {% else %}
  <span>…</span>
  {% endif %}
  {% endfor %}

  {% if pagination.has_next %}
  <a href="{{ url_for('profile_views.notifications', page=pagination.next_num) }}">Next »</a>
  {% else %}
  <span>Next »</span>
  {% endif %}
</div>
{% else %}
<p>No notifications.</p>
{% endif %}
{% endblock %}